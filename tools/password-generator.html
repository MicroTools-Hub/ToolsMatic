<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Password Generator | MicroTools</title>
  <meta name="description" content="Generate strong, customizable passwords locally with the MicroTools Password Generator. Control length, symbols, and casing without sending data to a server.">
  <link rel="manifest" href="/manifest.webmanifest">
  <link rel="stylesheet" href="../assets/styles.css">
  <script src="/assets/site.js" defer></script>
</head>
<body>
  <header>
    <div class="nav">
      <a class="brand" href="/">
        <span>Micro</span>Tools
      </a>
      <div class="nav-links">
        <a href="/">Home</a>
        <a href="/tools/word-counter.html">Word Counter</a>
        <a href="/tools/password-generator.html">Password Generator</a>
        <a href="/tools/quote-generator.html">Quote Generator</a>
        <a href="/tools/case-converter.html">Case Converter</a>
        <a href="/tools/gradient-generator.html">Gradient Generator</a>
      </div>
    </div>
  </header>

  <main>
    <section class="tool-shell">
      <h1>Password Generator</h1>
      <div class="two-col">
        <label class="label" style="margin-bottom:4px;">Mode
          <select id="mode" style="width:100%;margin-top:4px;">
            <option value="password" selected>Random password</option>
            <option value="passphrase">Passphrase (diceware style)</option>
          </select>
        </label>
        <label class="label" style="margin-bottom:4px;">Policy
          <select id="policy" style="width:100%;margin-top:4px;">
            <option value="custom" selected>Custom</option>
            <option value="nist">NIST (16 chars, mixed)</option>
            <option value="long">Long, no symbols (20 chars)</option>
            <option value="owasp">OWASP-friendly (14 chars, mixed)</option>
            <option value="diceware">Diceware preset (5 words)</option>
          </select>
        </label>
      </div>

      <div id="password-options">
        <label class="label" for="base-words">Base words (optional, for memorable passwords)</label>
        <input id="base-words" placeholder="e.g. project codename or phrase">
        <label class="label" for="length">Length</label>
        <input id="length" class="small-input" type="number" value="16" min="8" max="64">
        <div class="inline-controls">
          <label><input type="checkbox" id="upper" checked> Include uppercase</label>
          <label><input type="checkbox" id="lower" checked> Include lowercase</label>
          <label><input type="checkbox" id="numbers" checked> Include numbers</label>
          <label><input type="checkbox" id="symbols"> Include symbols</label>
        </div>
        <div class="inline-controls" style="margin-top:8px;">
          <label><input type="checkbox" id="no-ambig"> Avoid lookalike characters</label>
          <label><input type="checkbox" id="memorable"> Make memorable from input</label>
        </div>
      </div>

      <div id="passphrase-options" style="display:none;">
        <label class="label" for="words">Words per passphrase</label>
        <input id="words" class="small-input" type="number" value="5" min="3" max="10">
        <div class="inline-controls" style="margin-top:8px;">
          <label style="flex:1;">Separator
            <input id="separator" placeholder="-" value="-">
          </label>
          <label style="flex:1;">Casing
            <select id="case-mode" style="width:100%;margin-top:4px;">
              <option value="lower">lowercase</option>
              <option value="title">Title Case</option>
              <option value="upper">UPPERCASE</option>
            </select>
          </label>
          <label><input type="checkbox" id="add-number" checked> Add number suffix</label>
        </div>
      </div>

      <div class="inline-controls" style="margin-top:12px;">
        <button id="generate" data-primary>Generate</button>
        <button id="copy">Copy</button>
      </div>
      <div class="result-box" id="password">Generate a password or passphrase to see it here.</div>
      <div class="meter" aria-hidden="true"><div class="meter-fill" id="strength-fill"></div></div>
      <div class="result-box" id="entropy">Entropy: 0 bits · Strength: N/A</div>
      <div class="muted-text">Ctrl/Cmd+Enter generates; Esc clears memorable input.</div>

      <h3 style="margin-top:16px;">Recent outputs <span class="tag">Local only</span></h3>
      <div class="history-list" id="history"></div>
    </section>

    <section class="section" aria-labelledby="pg-what">
      <h2 id="pg-what">What is this tool?</h2>
      <p>The MicroTools Password Generator builds strong, random passwords on demand. You control the length and which character sets are included, and the generator assembles a high-entropy string for logins, API tokens, or secure notes without installing anything.</p>
      <p>By sticking to a few clear toggles, the page avoids configuration fatigue while still meeting most policy requirements. It is designed for speed, repeatable results, and frictionless handoff to your vault so you keep rotating credentials.</p>
      <p>Because everything runs in your browser, you avoid the risk of cloud-based generators storing or replaying sensitive secrets.</p>
      <h2>How to use this tool</h2>
      <p>Pick a length, select the character sets you need, and click Generate. The tool builds a matching pool and produces a password instantly. Use Copy to place it on your clipboard and save it in your password manager.</p>
      <p>If you follow a corporate policy, match the required length and disable symbols if certain services reject them. Regenerate until you see a mix that fits the rules, then test it in the destination app to confirm acceptance.</p>
      <p>When creating temporary credentials for teammates or CI, generate, paste, and rotate after use. The page stays ready for repeated runs so you can issue several passwords in a row.</p>
      <h2>Who should use it?</h2>
      <p>Developers provisioning new services, IT teams rolling passwords, creators protecting social profiles, and anyone avoiding reuse can rely on this tool. It also helps freelancers and students who need unique credentials that do not overlap with personal accounts.</p>
      <p>Security responders, DevOps practitioners, and educators can keep it open during incidents, deployments, or classroom demos to illustrate randomness and good hygiene.</p>
      <h2>Why use MicroTools for this?</h2>
      <p>MicroTools keeps the interface minimal, free of pop-ups, and fast on slow networks. With no external libraries, it loads quickly and behaves consistently, making it easy to include in secure workflows alongside your vault or ticketing system.</p>
      <p>The consistent MicroTools layout reduces context switching. You can jump to the Regex Tester to validate allowed characters or the URL Encoder for webhook setup without relearning controls.</p>
      <h2>Privacy & performance</h2>
      <p>Generation happens entirely client-side. Nothing is logged or sent to any server, and the produced string only lives on the page and your clipboard. The script is small, keeping performance high on low-power devices.</p>
      <p>Because it works without network calls, you can safely create passwords while traveling, in secure facilities, or on flaky connections without exposing sensitive credentials.</p>
    </section>
  </main>

  <footer>
    MicroTools · Fast, privacy-first utilities for the web.
  </footer>

  <script>
    const lengthInput = document.getElementById('length');
    const upper = document.getElementById('upper');
    const lower = document.getElementById('lower');
    const numbers = document.getElementById('numbers');
    const symbols = document.getElementById('symbols');
    const avoidAmbig = document.getElementById('no-ambig');
    const memorable = document.getElementById('memorable');
    const baseWords = document.getElementById('base-words');
    const policy = document.getElementById('policy');
    const passwordBox = document.getElementById('password');
    const entropyBox = document.getElementById('entropy');
    const generateBtn = document.getElementById('generate');
    const copyBtn = document.getElementById('copy');
    const modeSelect = document.getElementById('mode');
    const passwordOptions = document.getElementById('password-options');
    const passphraseOptions = document.getElementById('passphrase-options');
    const wordsInput = document.getElementById('words');
    const separatorInput = document.getElementById('separator');
    const caseMode = document.getElementById('case-mode');
    const addNumber = document.getElementById('add-number');
    const historyList = document.getElementById('history');
    const strengthFill = document.getElementById('strength-fill');

    const settingsKey = 'pg-settings-v2';
    const historyKey = 'pg-history-v2';
    const maxHistory = 6;

    const sets = {
      upper: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ',
      lower: 'abcdefghijklmnopqrstuvwxyz',
      numbers: '0123456789',
      symbols: '!@#$%^&*()-_=+[]{};:,.<>/?',
      ambig: 'O0o1lI|S5B8Z2'
    };

    const diceWords = [
      'able','about','ace','acid','acorn','actor','adapt','agent','agree','alpha','amber','angle','apple','april','arc','armor','arrow','artist','atom','aura','award','badge','baker','basic','beacon','beard','beaver','begin','beyond','bike','bison','blade','blast','blend','blink','bonus','bounty','breeze','brick','brisk','broom','cabin','cable','cactus','camel','candle','canoe','carbon','cargo','carve','castle','cello','chalk','chant','chase','cheer','chess','chief','cider','civic','clay','clear','cliff','climb','cloak','clock','cloud','clover','cobalt','cocoa','coconut','comic','compass','copper','cosmic','cotton','coyote','crane','crisp','crown','crystal','cubic','curry','daisy','delta','desert','digit','dingo','disco','dizzy','dolphin','dragon','dream','drift','dune','eagle','ember','enjoy','enlist','epic','epoch','equal','estate','ethic','excel','falcon','fancy','feather','fiber','field','finch','flame','flash','flock','fluent','focus','forest','forge','formal','fox','frame','fresh','frost','fusion','galaxy','gamma','garden','gator','gem','giant','glide','globe','glow','gnome','gold','grace','grain','grand','graph','green','grid','groove','grove','guard','guest','guide','harbor','hazel','helium','hero','hinge','honey','honor','horn','hotel','hub','humble','hybrid','ice','icon','idea','iguana','impact','index','ink','input','iris','island','ivory','jade','jazz','jet','jewel','jolly','judge','jungle','jupiter','karma','kayak','keystone','king','kite','kiwi','ladder','laser','lava','leaf','lemon','level','light','linen','lion','logic','lunar','lunch','lynx','magnet','maple','marble','marine','matrix','meadow','melon','metal','meter','metro','micro','midnight','mint','mirror','mist','model','molecule','monkey','moss','motion','mountain','muffin','myth','nebula','nectar','neon','night','noble','north','novel','nucleus','oasis','oak','ocean','octave','omega','onion','opal','orbit','orca','owl','oxygen','palm','panel','paper','parcel','pasta','patch','patio','pearl','pegasus','pepper','petal','photon','piano','pigeon','pilot','pine','pixel','planet','plasma','plume','poem','polar','pond','pulse','puma','pure','python','quartz','quest','quiet','quill','radar','radio','raven','razor','rebel','reef','relic','ribbon','ridge','rider','ripple','river','robot','rocket','rogue','rose','round','rover','ruby','runner','saber','safari','sage','sail','salmon','saturn','scout','scroll','seagull','season','seed','shadow','shard','shark','shelter','shield','ship','signal','silk','silver','sketch','sky','slate','sleet','sling','smith','smoke','snail','snow','solar','sonic','sound','south','space','spark','spear','spell','spice','spider','spike','spirit','splash','spoon','spring','square','stable','stack','stage','stall','star','steam','stellar','stone','storm','story','strand','straw','stream','street','string','strong','studio','sugar','sun','swift','symbol','table','tango','tanker','taper','tartan','tempo','tiger','timber','titan','toast','token','topaz','torch','tower','track','trail','transit','tree','trident','tropic','trust','tulip','tunnel','turbo','turtle','ultra','union','unite','urban','utopia','valley','vapor','vector','velvet','vessel','viking','violet','vision','vista','vivid','vortex','voyage','wagon','water','wave','weave','whale','wheat','whisper','widow','wild','willow','wind','window','wing','winter','wolf','wool','xenon','yacht','yard','year','yellow','young','zebra','zenith','zephyr','zinc','zodiac'
    ];

    const randomFrom = (pool) => pool[Math.floor(Math.random() * pool.length)];
    const clampNumber = (value, min, max, fallback) => {
      const n = parseInt(value, 10);
      if (Number.isNaN(n)) return fallback;
      return Math.min(max, Math.max(min, n));
    };

    const cleanWord = (word) => word.replace(/[^a-z0-9]/gi, '');
    const stylizeWord = (word) => {
      const cleaned = cleanWord(word);
      if (!cleaned) return '';
      if (!upper.checked && lower.checked) return cleaned.toLowerCase();
      if (upper.checked && !lower.checked) return cleaned.toUpperCase();
      return cleaned[0].toUpperCase() + cleaned.slice(1).toLowerCase();
    };

    const stylizeDiceWord = (word) => {
      if (caseMode.value === 'upper') return word.toUpperCase();
      if (caseMode.value === 'title') return word[0].toUpperCase() + word.slice(1);
      return word;
    };

    const persistSettings = () => {
      const payload = {
        mode: modeSelect.value,
        policy: policy.value,
        length: lengthInput.value,
        upper: upper.checked,
        lower: lower.checked,
        numbers: numbers.checked,
        symbols: symbols.checked,
        avoidAmbig: avoidAmbig.checked,
        memorable: memorable.checked,
        baseWords: baseWords.value,
        words: wordsInput.value,
        separator: separatorInput.value,
        caseMode: caseMode.value,
        addNumber: addNumber.checked
      };
      localStorage.setItem(settingsKey, JSON.stringify(payload));
    };

    const renderHistory = () => {
      const records = JSON.parse(localStorage.getItem(historyKey) || '[]');
      historyList.innerHTML = '';
      if (!records.length) {
        const empty = document.createElement('div');
        empty.className = 'muted-text';
        empty.textContent = 'No history yet. Generate to capture your last runs (local only).';
        historyList.appendChild(empty);
        return;
      }
      records.forEach((item) => {
        const row = document.createElement('div');
        row.className = 'history-item';
        const value = document.createElement('div');
        value.className = 'history-value';
        value.textContent = item.value;
        const meta = document.createElement('span');
        meta.className = 'tag';
        meta.textContent = item.mode === 'passphrase' ? 'Passphrase' : 'Password';
        const copyBtnRow = document.createElement('button');
        copyBtnRow.className = 'ghost';
        copyBtnRow.textContent = 'Copy';
        copyBtnRow.addEventListener('click', async () => {
          await navigator.clipboard.writeText(item.value);
          if (window.microTools) window.microTools.showToast('Copied from history', 'success');
        });
        row.appendChild(value);
        row.appendChild(meta);
        row.appendChild(copyBtnRow);
        historyList.appendChild(row);
      });
    };

    const pushHistory = (modeValue, value) => {
      if (!value || value.startsWith('Generate')) return;
      const records = JSON.parse(localStorage.getItem(historyKey) || '[]');
      records.unshift({ mode: modeValue, value });
      while (records.length > maxHistory) records.pop();
      localStorage.setItem(historyKey, JSON.stringify(records));
      renderHistory();
    };

    const updateStrength = (entropy) => {
      const capped = Math.min(entropy, 128);
      strengthFill.style.width = `${(capped / 128) * 100}%`;
    };

    const generatePassword = () => {
      const length = clampNumber(lengthInput.value, 8, 64, 16);
      lengthInput.value = length;
      let pool = '';
      if (upper.checked) pool += sets.upper;
      if (lower.checked) pool += sets.lower;
      if (numbers.checked) pool += sets.numbers;
      if (symbols.checked) pool += sets.symbols;
      if (avoidAmbig.checked) {
        pool = pool
          .split('')
          .filter((ch) => !sets.ambig.includes(ch))
          .join('');
      }
      if (!pool) {
        passwordBox.textContent = 'Select at least one character set to generate a password.';
        return { value: '', entropy: 0, strength: 'Weak' };
      }

      const wordsRaw = baseWords.value.trim();
      const useMemorable = memorable.checked && wordsRaw.length;
      let pwd = '';

      if (useMemorable) {
        const words = wordsRaw.split(/\s+/).slice(0, 4).map(stylizeWord).filter(Boolean);
        const sepPool = symbols.checked ? '-_!@#'.split('') : ['-'];
        const digits = numbers.checked ? `${Math.floor(Math.random() * 90) + 10}` : '';
        pwd = words.join(randomFrom(sepPool));
        if (digits) pwd += digits;
        if (pwd.length < length) {
          while (pwd.length < length) pwd += randomFrom(pool);
        } else if (pwd.length > length) {
          pwd = pwd.slice(0, length);
        }
      } else {
        for (let i = 0; i < length; i += 1) {
          pwd += randomFrom(pool);
        }
      }

      const entropy = Math.round(length * Math.log2(pool.length));
      const strength = entropy > 110 ? 'Very strong' : entropy > 80 ? 'Strong' : entropy > 60 ? 'Good' : 'Weak';
      return { value: pwd, entropy, strength };
    };

    const generatePassphrase = () => {
      const wordsCount = clampNumber(wordsInput.value, 3, 10, 5);
      wordsInput.value = wordsCount;
      const sep = separatorInput.value || '-';
      const pieces = [];
      for (let i = 0; i < wordsCount; i += 1) {
        const word = stylizeDiceWord(randomFrom(diceWords));
        pieces.push(word);
      }
      let phrase = pieces.join(sep);
      if (addNumber.checked) {
        phrase += `${Math.floor(Math.random() * 90) + 10}`;
      }
      const entropy = Math.round(wordsCount * Math.log2(diceWords.length) + (addNumber.checked ? Math.log2(100) : 0));
      const strength = entropy > 120 ? 'Very strong' : entropy > 90 ? 'Strong' : entropy > 70 ? 'Good' : 'Weak';
      return { value: phrase, entropy, strength };
    };

    const generate = () => {
      const modeValue = modeSelect.value;
      const result = modeValue === 'passphrase' ? generatePassphrase() : generatePassword();
      if (!result.value) return;
      passwordBox.textContent = result.value;
      entropyBox.textContent = `Entropy: ${result.entropy} bits · Strength: ${result.strength}`;
      updateStrength(result.entropy);
      pushHistory(modeValue, result.value);
      persistSettings();
    };

    const applyPolicy = () => {
      if (policy.value === 'nist') {
        modeSelect.value = 'password';
        lengthInput.value = 16;
        upper.checked = true;
        lower.checked = true;
        numbers.checked = true;
        symbols.checked = true;
        avoidAmbig.checked = false;
      } else if (policy.value === 'long') {
        modeSelect.value = 'password';
        lengthInput.value = 20;
        upper.checked = true;
        lower.checked = true;
        numbers.checked = true;
        symbols.checked = false;
        avoidAmbig.checked = true;
      } else if (policy.value === 'owasp') {
        modeSelect.value = 'password';
        lengthInput.value = 14;
        upper.checked = true;
        lower.checked = true;
        numbers.checked = true;
        symbols.checked = true;
        avoidAmbig.checked = true;
      } else if (policy.value === 'diceware') {
        modeSelect.value = 'passphrase';
        wordsInput.value = 5;
        separatorInput.value = '-';
        addNumber.checked = true;
        caseMode.value = 'title';
      }
      toggleMode();
      generate();
    };

    const toggleMode = () => {
      const isPassphrase = modeSelect.value === 'passphrase';
      passwordOptions.style.display = isPassphrase ? 'none' : 'block';
      passphraseOptions.style.display = isPassphrase ? 'block' : 'none';
    };

    const loadSettings = () => {
      try {
        const saved = JSON.parse(localStorage.getItem(settingsKey) || '{}');
        if (!saved) return;
        modeSelect.value = saved.mode || 'password';
        policy.value = saved.policy || 'custom';
        lengthInput.value = saved.length || 16;
        upper.checked = saved.upper ?? true;
        lower.checked = saved.lower ?? true;
        numbers.checked = saved.numbers ?? true;
        symbols.checked = saved.symbols ?? false;
        avoidAmbig.checked = saved.avoidAmbig ?? false;
        memorable.checked = saved.memorable ?? false;
        baseWords.value = saved.baseWords || '';
        wordsInput.value = saved.words || 5;
        separatorInput.value = saved.separator || '-';
        caseMode.value = saved.caseMode || 'lower';
        addNumber.checked = saved.addNumber ?? true;
      } catch (err) {
        // ignore corrupted state
      }
    };

    const copy = async () => {
      const value = passwordBox.textContent;
      if (!value || value.startsWith('Generate')) return;
      try {
        await navigator.clipboard.writeText(value);
        if (window.microTools) window.microTools.showToast('Copied to clipboard', 'success');
      } catch (err) {
        if (window.microTools) window.microTools.showToast('Copy failed', 'error');
      }
    };

    generateBtn.addEventListener('click', generate);
    copyBtn.addEventListener('click', copy);
    policy.addEventListener('change', applyPolicy);
    memorable.addEventListener('change', generate);
    baseWords.addEventListener('input', () => { if (memorable.checked) generate(); });
    modeSelect.addEventListener('change', () => { policy.value = 'custom'; toggleMode(); persistSettings(); });
    [lengthInput, upper, lower, numbers, symbols, avoidAmbig].forEach((el) => {
      el.addEventListener('change', () => { policy.value = 'custom'; persistSettings(); });
    });
    [wordsInput, separatorInput, caseMode, addNumber].forEach((el) => {
      el.addEventListener('change', () => { policy.value = 'custom'; persistSettings(); });
    });

    document.addEventListener('keydown', (e) => {
      if ((e.metaKey || e.ctrlKey) && e.key === 'Enter') generate();
      if (e.key === 'Escape') baseWords.value = '';
    });

    loadSettings();
    toggleMode();
    renderHistory();
    generate();
  </script>
</body>
</html>
